C51 COMPILER V9.60.0.0   MAIN                                                              08/04/2020 16:54:56 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\keilc51\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #include <stdio.h>
   4          #define uchar unsigned char
   5          #define uint unsigned int
   6          sbit light=P2^1;
   7          sbit key1=P3^1;
   8          sbit key2=P3^2;
   9          
  10          sbit DIN=P3^4;
  11          sbit CS=P3^5;
  12          sbit DCLK=P3^6;
  13          sbit DOUT=P3^7;
  14          /*延时ms函数*/
  15          void delayms(uint z)
  16          {
  17   1              uint i,j;
  18   1              for(i=z;i>0;i--)
  19   1                      for(j=110;j>0;j--);
  20   1      }
  21          /*灯的开关*/
  22          void switchLight(uchar i)
  23          {
  24   1              if(i==1)
  25   1                      light=0;
  26   1              if(i==2)
  27   1                      light=1;
  28   1      }
  29          /*按键控制小灯开关*/
  30          void keyControl(void)
  31          {
  32   1              if(key1==0)
  33   1              {
  34   2                      delayms(10);
  35   2                      if(key1==0)
  36   2                      {
  37   3                              switchLight(1);
  38   3                      }
  39   2                      while(!key1);
  40   2              }
  41   1              if(key2==0)
  42   1              {
  43   2                      delayms(10);
  44   2                      if(key2==0)
  45   2                      {
  46   3                              switchLight(2);
  47   3                      }
  48   2                      while(!key2);
  49   2              }
  50   1      }
  51          /*光敏传感器控制灯开关*/
  52          
  53          //AD写入操作
  54          void adWrite(uchar dat)
C51 COMPILER V9.60.0.0   MAIN                                                              08/04/2020 16:54:56 PAGE 2   

  55          {
  56   1              uint i;
  57   1              CS=0;
  58   1              DCLK=0;
  59   1              for(i=0;i<8;i++)
  60   1              {
  61   2                      DIN=dat;
  62   2                      dat<<=1;
  63   2                      DCLK=1;
  64   2                      
  65   2                      DCLK=0;
  66   2              }
  67   1      }
  68          //AD读取数据操作
  69          uint adRead()
  70          {
  71   1              uint i,dat=0;
  72   1              CS=0;
  73   1              for(i=0;i<12;i++)
  74   1              {
  75   2                      DCLK=0;
  76   2                      dat<<=1;
  77   2                      dat|=DOUT;
  78   2                      DCLK=1;
  79   2              }
  80   1              return dat;
  81   1      }
  82          //命令转换操作
  83          uint adReadData(uchar dat)              //光敏电阻为 0xc4
  84          {
  85   1              uint i,AD_value;
  86   1              DCLK=0;
  87   1              CS=0;
  88   1              adWrite(dat);
  89   1              for(i=6;i>0;i--);
  90   1              DCLK=1;
  91   1              _nop_();
  92   1              _nop_();
  93   1              DCLK=0;
  94   1              _nop_();
  95   1              _nop_();
  96   1              AD_value=adRead();
  97   1              CS=1;
  98   1              return AD_value;
  99   1      }
 100          //封装开关
 101          void adSwitch(uchar dat)
 102          {
 103   1              if(adReadData(dat)<200)
 104   1                      switchLight(1);
 105   1              else
 106   1                      switchLight(2);
 107   1      }
 108          
 109          /*WIFI控制小灯的亮灭*/
 110          //初始化
 111          void wifiInit()
 112          {
 113   1              TMOD=0x20;              //波特率9600
 114   1              TL1=0xfd;
 115   1              TH1=0xfd;
 116   1              TR1=1;
C51 COMPILER V9.60.0.0   MAIN                                                              08/04/2020 16:54:56 PAGE 3   

 117   1              SM0=0;
 118   1              SM1=1;
 119   1              REN=1;
 120   1      }
 121          //设置WiFi打开端口号
 122          void wifiConfig()
 123          {
 124   1              printf("AT+CWMODE+1");
 125   1              delayms(1000);
 126   1              printf("AT+RST");
 127   1              delayms(1000);
 128   1              printf("AT+CWJAP=\"XXX\",\"XXX\"");
 129   1              delayms(1000);
 130   1              printf("AT+CIPMUX=1");
 131   1              delayms(1000);
 132   1              printf("AT+CIPSERVER=1,8080");
 133   1              delayms(1000);
 134   1              //to do液晶显示设置成功
 135   1      }
 136          //封装开关
 137          void wifiSwitch()
 138          {
 139   1              uchar a;
 140   1              a=SBUF;
 141   1              if(a=='1')
 142   1                      switchLight(1);
 143   1              if(a=='2')
 144   1                      switchLight(2);
 145   1      }
 146          /*液晶实时状态回显*/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    321    ----
   CONSTANT SIZE    =     72    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
